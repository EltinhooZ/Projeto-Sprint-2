<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECCOligth</title>
    <link rel="stylesheet" href="../Css/menusRight.css">
    <link rel="stylesheet" href="../Css/contato.css">
    <link rel="stylesheet" href="../Css/equipe.css">
    <link rel="stylesheet" href="../Css/sobre.css">
    <link rel="stylesheet" href="../Css/index.css">
    <link rel="stylesheet" href="../Css/main.css">
    <link rel="stylesheet" href="../Plugins/fontawesome-free-5.13.0-web/css/all.min.css">
    <link rel="stylesheet" href="../Plugins/bootstrap-4.4.1-dist/css/bootstrap.min.css">
    <script src="https://www.chartjs.org/dist/2.9.3/Chart.min.js"></script>
    <script src="https://www.chartjs.org/samples/latest/utils.js"></script>
</head>

<body>
    <div class="dashboard">
        <sidebar>
            <div class="sidebar-title">
                <img src="../imgs/undraw_contract_uy56.png" alt="">
                <h2>ECCOlight</h2>
            </div>
            <div class="menu">
                <ul id="menus_right">
                    <li>
                        <a href="sobre.html"><i class="fas fa-book-open"></i> Sobre</a>
                    </li>
                    <li>
                        <a href="servico.html"><i class="fas fa-align-left"></i> Serviço</a>
                    </li>
                    <li>
                        <a href="equipe.html"><i class="fas fa-user-friends"></i> Equipe</a>
                    </li>
                    <li>
                        <a href="contato.html"><i class="fas fa-address-book"></i> Contato</a>
                    </li>
                </ul>
            </div>
        </sidebar>
        <main>
            <header>
                <a href="index.html" id="pt"><i class="fas fa-home"></i>Dashboard</a>
                <a href="Simulador.html" id="simulador"><i class="fas fa-clipboard-list"></i> Simulador </a>
                <a href="cadastro.html" id="cadastro"><i class="fas fa-user"></i>Cadastro</a>
                <a href="Inicio.html" id="logout"><i class="fas fa-sign-out-alt"></i>Logout</a>
            </header>
            <!--Dashboard-->
            <div class="content_painel">
                <div style="width:95%;">
                    <canvas id="c_grafico"></canvas>

                </div>
                <br>
                <br>
            </div>


        </main>
    </div>

</body>

</html>
<script src="../Plugins/bootstrap-4.4.1-dist/js/bootstrap.min.js"></script>
<script src="../Plugins/fontawesome-free-5.13.0-web/js/all.min.js"></script>
<script>
    var config = {
        type: 'line',
        data: {
            labels: [],
            datasets: [{
                label: 'Luminosidade',
                backgroundColor: window.chartColors.red,
                borderColor: window.chartColors.red,
                data: [],
                fill: false,
            }]
        },
        options: {
            responsive: true,
            title: {
                display: true,
                text: 'Gráfico de histórico de Luminosidade'
            },
            tooltips: {
                mode: 'index',
                intersect: false,
            },
            hover: {
                mode: 'nearest',
                intersect: true
            },
            scales: {
                xAxes: [{
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: 'Horário da Leitura'
                    }
                }],
                yAxes: [{
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: 'ºC'
                    }
                }]
            }
        }
    };

    function sortearTemperatura() {
        var limiteMin = 300;
        var limiteMax = 600;
        var minimoAbsoluto = Math.abs(limiteMin);

        var luminosidade = parseInt(Math.random() * (limiteMax - limiteMin)) + limiteMin;
        console.log(luminosidade);
        return luminosidade;

        // return (Math.random()* limiteMax );

    }

    function recuperarDadosIniciais() {
        var registros = [{
            momento: '00:03:42',
            leitura: sortearTemperatura()
        }, {
            momento: '00:03:52',
            leitura: sortearTemperatura()
        }, {
            momento: '00:04:02',
            leitura: sortearTemperatura()
        }, {
            momento: '00:04:12',
            leitura: sortearTemperatura()
        }, {
            momento: '00:04:22',
            leitura: sortearTemperatura()
        }, {
            momento: '00:04:32',
            leitura: sortearTemperatura()
        }, {
            momento: '00:04:42',
            leitura: sortearTemperatura()
        }];
        var contador = 0;

        while (contador < registros.length) {

            config.data.labels.push(registros[contador].momento);
            config.data.datasets[0].data.push(registros[contador].leitura);

            contador++;
        }

    }

    function receberNovasLeituras() {
        setTimeout(() => {

            var agora = new Date();
            var hora = agora.getHours();
            var minuto = agora.getMinutes();
            var segundo = agora.getSeconds();
            var momento = `${hora > 9 ? '' : '0'}${hora}:${minuto > 9 ? '' : '0'}${minuto}:${segundo > 9 ? '' : '0'}${segundo}`;

            var novoRegistro = {
                momento: momento,
                leitura: sortearTemperatura()
            };

            config.data.labels.shift();
            config.data.labels.push(novoRegistro.momento);
            config.data.datasets[0].data.shift();
            config.data.datasets[0].data.push(novoRegistro.leitura);

            window.myLine.update();

            receberNovasLeituras();

        }, 2000);
    }

    function plotarGrafico() {
        recuperarDadosIniciais();

        var ctx = document.getElementById('c_grafico').getContext('2d');
        window.myLine = new Chart(ctx, config);

        receberNovasLeituras();
    }

    window.onload = plotarGrafico;
</script>